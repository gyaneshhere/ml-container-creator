# Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
# SPDX-License-Identifier: Apache-2.0

# LMI/DJL Serving Configuration
# Documentation: https://docs.djl.ai/master/docs/serving/serving/docs/lmi/deployment_guide/index.html

<% if (modelServer === 'lmi') { %>
# LMI Container Configuration
# LMI provides optimized inference with multiple backend options

# Model Configuration
option.model_id=<%= modelName %>

# Backend Selection
# Options: vllm, lmi-dist (DeepSpeed), tensorrt-llm, transformers-neuronx
# Leave unset to let LMI auto-select the best backend for your model
# option.rolling_batch=vllm

# Tensor Parallel Degree
# Set to number of GPUs for multi-GPU inference
# option.tensor_parallel_degree=1

# Data Type
# Options: fp16, bf16, fp32, int8
# option.dtype=fp16

# Max Rolling Batch Size
# Maximum number of concurrent requests
# option.max_rolling_batch_size=32

<% if (hfToken) { %>
# HuggingFace Authentication
option.hf_token=<%= hfToken %>
<% } %>

<% if (chatTemplate) { %>
# Chat Template
# Custom chat template for formatting messages
option.chat_template=<%= chatTemplate %>
<% } %>

# Performance Tuning
# Uncomment and adjust based on your needs:
# option.max_model_len=4096
# option.gpu_memory_utilization=0.9
# option.enable_chunked_prefill=true

<% } else if (modelServer === 'djl') { %>
# DJL Serving Configuration
# DJL provides flexible model serving with multiple framework support

# Model Configuration
option.model_id=<%= modelName %>

# Engine Selection
# Options: Python, PyTorch, TensorFlow, MXNet
engine=Python

# Batch Size
# Maximum batch size for inference
# batch_size=1

# Job Queue Size
# Maximum number of queued requests
# job_queue_size=100

<% if (hfToken) { %>
# HuggingFace Authentication
option.hf_token=<%= hfToken %>
<% } %>

<% if (chatTemplate) { %>
# Chat Template
option.chat_template=<%= chatTemplate %>
<% } %>

# GPU Configuration
# option.tensor_parallel_degree=1
# option.device_map=auto

<% } %>

# Additional Environment-Specific Configuration
<% if (orderedEnvVars && orderedEnvVars.length > 0) { %>
# Custom environment variables from configuration
<% orderedEnvVars.forEach(({ key, value }) => { %>
# <%= key %>=<%= value %>
<% }); %>
<% } %>
